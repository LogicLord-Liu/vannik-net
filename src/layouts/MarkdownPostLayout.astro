---
import "../styles/markdown.scss";
import ScrollToTop from "../components/ScrollToTop";

const {
  frontmatter: { title, date, author = "ä½šå", cover, tags = [], readingTime },
} = Astro.props;
---

<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <link rel="icon" href="/public/gerrenxingxiangzhao.ico" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <article class="post-container">
      {cover && <img src={cover} alt={title} class="cover" />}

      <header class="post-header">
        <h1 class="post-title">{title}</h1>
        <div class="post-meta">
          <time>{new Date(date).toLocaleDateString()}</time>
          <span>Â·</span>
          <span>{author}</span>
          {
            readingTime && (
              <>
                <span>Â·</span>
                <span>{readingTime}</span>
              </>
            )
          }
        </div>
        {
          tags.length > 0 && (
            <div class="post-tags">
              {tags.map((tag) => (
                <span class="tag" key={tag}>
                  #{tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <!-- Markdown æ¸²æŸ“åŒºåŸŸ -->
      <section class="markdown-content">
        <slot />
      </section>
    </article>

    <script type="module">
      import mediumZoom from "medium-zoom";

      mediumZoom(".markdown-content img", {
        background: "rgba(0, 0, 0, 0.8)",
        margin: 24,
        scrollOffset: 0,
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const blocks = document.querySelectorAll("pre");

        blocks.forEach((block) => {
          const wrapper = document.createElement("div");
          wrapper.className = "code-block-wrapper";

          // æ’å…¥ DOM
          block.parentNode.insertBefore(wrapper, block);
          wrapper.appendChild(block);

          // å¤åˆ¶æŒ‰é’®
          const copyBtn = document.createElement("button");
          copyBtn.className = "copy-btn";
          copyBtn.innerText = "ğŸ“‹ Copy";
          copyBtn.addEventListener("click", async () => {
            try {
              await navigator.clipboard.writeText(block.innerText);
              copyBtn.innerText = "âœ… Copied!";
              setTimeout(() => (copyBtn.innerText = "ğŸ“‹ Copy"), 2000);
            } catch {
              copyBtn.innerText = "âŒ Error";
            }
          });

          // æŠ˜å æŒ‰é’®
          const toggleBtn = document.createElement("button");
          toggleBtn.className = "toggle-btn";
          // åˆå§‹çŠ¶æ€å‡è®¾æ˜¯å±•å¼€çŠ¶æ€ï¼Œæ˜¾ç¤ºå‘ä¸Šç®­å¤´ï¼ˆâ–²ï¼‰
          toggleBtn.innerText = "â–² æŠ˜å ";

          toggleBtn.addEventListener("click", () => {
            block.classList.toggle("collapsed");

            // åˆ¤æ–­æ˜¯å¦æŠ˜å 
            const isCollapsed = block.classList.contains("collapsed");

            // æŠ˜å äº†æ˜¾ç¤ºå‘ä¸‹ç®­å¤´ï¼Œå±•å¼€äº†æ˜¾ç¤ºå‘ä¸Šç®­å¤´
            if (isCollapsed) {
              toggleBtn.innerText = "â–¼ å±•å¼€";
            } else {
              toggleBtn.innerText = "â–² æŠ˜å ";
            }
          });

          wrapper.appendChild(copyBtn);
          wrapper.appendChild(toggleBtn);
        });
      });
    </script>

    <ScrollToTop client:load />
  </body>
</html>
